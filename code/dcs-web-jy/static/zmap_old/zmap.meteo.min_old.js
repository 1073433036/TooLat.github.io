function WeatherScence(a,b,c,d,e,f,g,h){this.rcvs=a,this.rctx=b,this.bcvs=c,this.bctx=d,this.cvs=e,this.ctx=f,this.layer=g,this.map=h,this.show=!0,this.windColors=["rgba(253,178,253,0.7)","rgba(219,118,223,0.7)","rgba(169,75,192,0.7)","rgba(150,61,188,0.7)","rgba(112,38,176,0.7)","rgba(75,18,160,0.7)","rgba(43,50,155,0.7)","rgba(23,95,193,0.7)","rgba(9,171,218,0.7)","rgba(0,201,243,0.7)","rgba(1,220,186,0.7)","rgba(0,207,85,0.7)","rgba(15,192,13,0.7)","rgba(78,202,2,0.7)","rgba(185,218,4,0.7)","rgba(243,238,3,0.7)","rgba(255,240,0,0.7)","rgba(255,195,0,0.7)","rgba(252,130,0,0.7)","rgba(242,65,0,0.7)","rgba(223,46,2,0.7)","rgba(202,30,2,0.7)","rgba(183,17,2,0.7)","rgba(163,9,2,0.7)"]}L.Util.Bounds={GuangDong:[{x:112.016,y:24.74},{x:112.03,y:24.771},{x:112.098,y:24.832},{x:112.149,y:24.815},{x:112.167,y:24.916},{x:112.109,y:24.967},{x:112.145,y:25.02},{x:112.181,y:25.184},{x:112.29,y:25.157},{x:112.356,y:25.193},{x:112.386,y:25.147},{x:112.482,y:25.151},{x:112.535,y:25.127},{x:112.651,y:25.132},{x:112.717,y:25.06},{x:112.698,y:25.011},{x:112.775,y:24.941},{x:112.774,y:24.897},{x:112.855,y:24.897},{x:112.891,y:24.92},{x:112.988,y:24.921},{x:113.002,y:24.992},{x:112.972,y:25.048},{x:113.009,y:25.08},{x:112.964,y:25.136},{x:113.024,y:25.209},{x:112.974,y:25.254},{x:112.863,y:25.248},{x:112.853,y:25.329},{x:113.015,y:25.348},{x:113.079,y:25.382},{x:113.154,y:25.488},{x:113.227,y:25.515},{x:113.293,y:25.499},{x:113.365,y:25.401},{x:113.535,y:25.366},{x:113.574,y:25.313},{x:113.682,y:25.349},{x:113.755,y:25.359},{x:113.812,y:25.328},{x:113.878,y:25.394},{x:113.884,y:25.436},{x:113.992,y:25.436},{x:114.035,y:25.358},{x:114.012,y:25.285},{x:114.028,y:25.255},{x:114.118,y:25.312},{x:114.155,y:25.316},{x:114.22,y:25.278},{x:114.277,y:25.277},{x:114.299,y:25.333},{x:114.382,y:25.318},{x:114.53,y:25.419},{x:114.627,y:25.329},{x:114.697,y:25.319},{x:114.737,y:25.243},{x:114.696,y:25.217},{x:114.677,y:25.173},{x:114.732,y:25.129},{x:114.67,y:25.111},{x:114.644,y:25.078},{x:114.558,y:25.086},{x:114.529,y:25.023},{x:114.462,y:24.999},{x:114.39,y:24.952},{x:114.395,y:24.878},{x:114.329,y:24.807},{x:114.331,y:24.754},{x:114.27,y:24.704},{x:114.174,y:24.677},{x:114.187,y:24.653},{x:114.275,y:24.628},{x:114.303,y:24.573},{x:114.373,y:24.566},{x:114.426,y:24.487},{x:114.528,y:24.554},{x:114.587,y:24.535},{x:114.654,y:24.578},{x:114.68,y:24.537},{x:114.733,y:24.566},{x:114.725,y:24.609},{x:114.787,y:24.609},{x:114.884,y:24.582},{x:114.906,y:24.663},{x:114.939,y:24.65},{x:115.083,y:24.681},{x:115.151,y:24.68},{x:115.211,y:24.725},{x:115.286,y:24.757},{x:115.353,y:24.74},{x:115.365,y:24.775},{x:115.466,y:24.764},{x:115.545,y:24.682},{x:115.572,y:24.619},{x:115.67,y:24.599},{x:115.722,y:24.537},{x:115.832,y:24.565},{x:115.762,y:24.665},{x:115.752,y:24.746},{x:115.762,y:24.798},{x:115.812,y:24.903},{x:115.877,y:24.936},{x:115.973,y:24.923},{x:116.026,y:24.898},{x:116.046,y:24.857},{x:116.139,y:24.845},{x:116.192,y:24.865},{x:116.239,y:24.793},{x:116.304,y:24.803},{x:116.385,y:24.874},{x:116.413,y:24.841},{x:116.389,y:24.799},{x:116.415,y:24.74},{x:116.485,y:24.713},{x:116.544,y:24.613},{x:116.594,y:24.65},{x:116.722,y:24.666},{x:116.79,y:24.633},{x:116.752,y:24.546},{x:116.789,y:24.501},{x:116.843,y:24.477},{x:116.837,y:24.431},{x:116.907,y:24.365},{x:116.93,y:24.225},{x:116.984,y:24.168},{x:116.929,y:24.121},{x:116.939,y:24.029},{x:116.976,y:24},{x:116.964,y:23.904},{x:117.015,y:23.839},{x:117.046,y:23.703},{x:117.127,y:23.652},{x:117.181,y:23.638},{x:117.123,y:23.567},{x:117.086,y:23.569},{x:117.072,y:23.618},{x:116.963,y:23.612},{x:116.999,y:23.545},{x:116.942,y:23.516},{x:116.894,y:23.56},{x:116.853,y:23.425},{x:116.735,y:23.339},{x:116.768,y:23.299},{x:116.787,y:23.212},{x:116.709,y:23.243},{x:116.647,y:23.167},{x:116.566,y:23.177},{x:116.533,y:23.113},{x:116.555,y:23.088},{x:116.552,y:23.014},{x:116.506,y:22.944},{x:116.378,y:22.929},{x:116.303,y:22.967},{x:116.223,y:22.925},{x:116.168,y:22.867},{x:116.097,y:22.822},{x:116.058,y:22.855},{x:115.972,y:22.819},{x:115.888,y:22.799},{x:115.827,y:22.755},{x:115.797,y:22.765},{x:115.795,y:22.82},{x:115.764,y:22.845},{x:115.699,y:22.851},{x:115.647,y:22.885},{x:115.561,y:22.826},{x:115.517,y:22.758},{x:115.573,y:22.679},{x:115.535,y:22.673},{x:115.47,y:22.704},{x:115.383,y:22.691},{x:115.34,y:22.737},{x:115.324,y:22.792},{x:115.25,y:22.792},{x:115.223,y:22.839},{x:115.033,y:22.786},{x:115.014,y:22.706},{x:114.974,y:22.693},{x:114.873,y:22.601},{x:114.803,y:22.593},{x:114.74,y:22.607},{x:114.732,y:22.666},{x:114.752,y:22.754},{x:114.822,y:22.787},{x:114.798,y:22.828},{x:114.743,y:22.778},{x:114.689,y:22.795},{x:114.577,y:22.742},{x:114.541,y:22.712},{x:114.529,y:22.658},{x:114.591,y:22.659},{x:114.537,y:22.575},{x:114.624,y:22.513},{x:114.518,y:22.451},{x:114.482,y:22.474},{x:114.482,y:22.536},{x:114.41,y:22.613},{x:114.266,y:22.589},{x:114.228,y:22.548},{x:114.162,y:22.562},{x:114.091,y:22.538},{x:114.056,y:22.504},{x:114.017,y:22.528},{x:113.912,y:22.534},{x:113.835,y:22.589},{x:113.781,y:22.678},{x:113.77,y:22.754},{x:113.673,y:22.743},{x:113.635,y:22.794},{x:113.607,y:22.742},{x:113.571,y:22.74},{x:113.525,y:22.781},{x:113.436,y:22.733},{x:113.527,y:22.655},{x:113.57,y:22.566},{x:113.572,y:22.496},{x:113.533,y:22.403},{x:113.591,y:22.341},{x:113.57,y:22.288},{x:113.59,y:22.247},{x:113.531,y:22.175},{x:113.37,y:22.172},{x:113.296,y:22.045},{x:113.265,y:22.05},{x:113.222,y:21.992},{x:113.193,y:22.059},{x:113.111,y:22.079},{x:113.134,y:22.149},{x:113.112,y:22.198},{x:113.078,y:22.193},{x:113.009,y:22.125},{x:112.994,y:22.081},{x:113.001,y:21.994},{x:113.035,y:21.954},{x:112.983,y:21.883},{x:112.906,y:21.845},{x:112.837,y:21.964},{x:112.742,y:21.924},{x:112.693,y:21.844},{x:112.65,y:21.839},{x:112.65,y:21.788},{x:112.592,y:21.754},{x:112.423,y:21.833},{x:112.433,y:21.894},{x:112.393,y:21.915},{x:112.417,y:21.771},{x:112.382,y:21.723},{x:112.31,y:21.699},{x:112.24,y:21.702},{x:112.192,y:21.733},{x:112.198,y:21.792},{x:112.132,y:21.8},{x:112.093,y:21.784},{x:111.956,y:21.802},{x:111.993,y:21.752},{x:111.914,y:21.696},{x:111.93,y:21.646},{x:111.99,y:21.658},{x:112.007,y:21.617},{x:111.886,y:21.585},{x:111.834,y:21.601},{x:111.913,y:21.658},{x:111.828,y:21.701},{x:111.842,y:21.737},{x:111.744,y:21.772},{x:111.713,y:21.741},{x:111.786,y:21.707},{x:111.767,y:21.622},{x:111.684,y:21.591},{x:111.667,y:21.525},{x:111.595,y:21.528},{x:111.488,y:21.5},{x:111.446,y:21.526},{x:111.372,y:21.496},{x:111.324,y:21.448},{x:111.25,y:21.487},{x:111.1,y:21.456},{x:111.072,y:21.505},{x:111.021,y:21.513},{x:110.991,y:21.42},{x:110.924,y:21.412},{x:110.887,y:21.381},{x:110.762,y:21.387},{x:110.677,y:21.303},{x:110.626,y:21.216},{x:110.532,y:21.204},{x:110.429,y:21.242},{x:110.425,y:21.376},{x:110.398,y:21.38},{x:110.385,y:21.265},{x:110.422,y:21.221},{x:110.394,y:21.149},{x:110.354,y:21.109},{x:110.412,y:21.055},{x:110.552,y:21.057},{x:110.526,y:20.972},{x:110.41,y:20.994},{x:110.344,y:20.989},{x:110.273,y:20.956},{x:110.285,y:21.011},{x:110.336,y:21.046},{x:110.307,y:21.095},{x:110.221,y:21.066},{x:110.181,y:21.022},{x:110.156,y:20.922},{x:110.169,y:20.844},{x:110.255,y:20.833},{x:110.313,y:20.842},{x:110.363,y:20.817},{x:110.389,y:20.776},{x:110.387,y:20.726},{x:110.329,y:20.692},{x:110.371,y:20.65},{x:110.401,y:20.586},{x:110.469,y:20.567},{x:110.531,y:20.466},{x:110.438,y:20.321},{x:110.372,y:20.3},{x:110.302,y:20.25},{x:110.193,y:20.265},{x:110.18,y:20.237},{x:110.122,y:20.235},{x:110.064,y:20.287},{x:109.934,y:20.277},{x:109.924,y:20.327},{x:109.865,y:20.398},{x:109.929,y:20.406},{x:109.981,y:20.349},{x:110.015,y:20.44},{x:109.971,y:20.46},{x:109.919,y:20.453},{x:109.894,y:20.487},{x:109.835,y:20.49},{x:109.839,y:20.542},{x:109.801,y:20.609},{x:109.738,y:20.657},{x:109.76,y:20.68},{x:109.766,y:20.76},{x:109.75,y:20.812},{x:109.71,y:20.804},{x:109.669,y:20.863},{x:109.661,y:20.933},{x:109.699,y:20.997},{x:109.708,y:21.056},{x:109.673,y:21.108},{x:109.688,y:21.146},{x:109.736,y:21.167},{x:109.775,y:21.231},{x:109.768,y:21.323},{x:109.804,y:21.347},{x:109.902,y:21.355},{x:109.922,y:21.412},{x:109.906,y:21.454},{x:109.842,y:21.478},{x:109.797,y:21.463},{x:109.741,y:21.621},{x:109.899,y:21.658},{x:109.931,y:21.75},{x:109.935,y:21.827},{x:109.979,y:21.88},{x:110.056,y:21.864},{x:110.167,y:21.896},{x:110.243,y:21.878},{x:110.296,y:21.914},{x:110.325,y:21.886},{x:110.382,y:21.894},{x:110.38,y:21.959},{x:110.351,y:21.988},{x:110.349,y:22.097},{x:110.415,y:22.209},{x:110.494,y:22.148},{x:110.553,y:22.195},{x:110.628,y:22.149},{x:110.674,y:22.187},{x:110.645,y:22.225},{x:110.763,y:22.322},{x:110.708,y:22.367},{x:110.708,y:22.445},{x:110.765,y:22.584},{x:110.885,y:22.588},{x:110.943,y:22.613},{x:110.954,y:22.643},{x:111.051,y:22.654},{x:111.113,y:22.745},{x:111.222,y:22.756},{x:111.284,y:22.808},{x:111.352,y:22.893},{x:111.358,y:22.969},{x:111.425,y:23.038},{x:111.373,y:23.095},{x:111.392,y:23.168},{x:111.351,y:23.288},{x:111.355,y:23.339},{x:111.385,y:23.379},{x:111.396,y:23.471},{x:111.446,y:23.503},{x:111.481,y:23.565},{x:111.483,y:23.632},{x:111.611,y:23.645},{x:111.66,y:23.714},{x:111.611,y:23.732},{x:111.636,y:23.812},{x:111.696,y:23.842},{x:111.8,y:23.815},{x:111.807,y:23.889},{x:111.925,y:23.974},{x:111.906,y:24.044},{x:111.871,y:24.09},{x:111.872,y:24.229},{x:111.93,y:24.236},{x:112.017,y:24.298},{x:112.057,y:24.365},{x:112.015,y:24.439},{x:111.981,y:24.469},{x:111.996,y:24.549},{x:111.941,y:24.587},{x:111.953,y:24.716},{x:112.016,y:24.74}],SimpleGuangDong:[{x:112.016,y:24.74},{x:112.167,y:24.916},{x:112.181,y:25.184},{x:112.651,y:25.132},{x:112.774,y:24.897},{x:112.988,y:24.921},{x:113.009,y:25.08},{x:112.974,y:25.254},{x:113.154,y:25.488},{x:113.293,y:25.499},{x:113.365,y:25.401},{x:113.574,y:25.313},{x:113.992,y:25.436},{x:114.118,y:25.312},{x:114.277,y:25.277},{x:114.53,y:25.419},{x:114.737,y:25.243},{x:114.644,y:25.078},{x:114.39,y:24.952},{x:114.331,y:24.754},{x:114.187,y:24.653},{x:114.373,y:24.566},{x:114.68,y:24.537},{x:114.787,y:24.609},{x:115.151,y:24.68},{x:115.286,y:24.757},{x:115.466,y:24.764},{x:115.572,y:24.619},{x:115.722,y:24.537},{x:115.762,y:24.798},{x:115.812,y:24.903},{x:115.973,y:24.923},{x:116.046,y:24.857},{x:116.385,y:24.874},{x:116.415,y:24.74},{x:116.594,y:24.65},{x:116.722,y:24.666},{x:116.752,y:24.546},{x:116.907,y:24.365},{x:116.964,y:23.904},{x:117.046,y:23.703},{x:116.894,y:23.56},{x:116.853,y:23.425},{x:116.735,y:23.339},{x:116.647,y:23.167},{x:116.533,y:23.113},{x:116.506,y:22.944},{x:116.303,y:22.967},{x:115.827,y:22.755},{x:115.647,y:22.885},{x:115.47,y:22.704},{x:115.383,y:22.691},{x:115.223,y:22.839},{x:115.033,y:22.786},{x:115.014,y:22.706},{x:114.873,y:22.601},{x:114.74,y:22.607},{x:114.689,y:22.795},{x:114.41,y:22.613},{x:114.017,y:22.528},{x:113.835,y:22.589},{x:113.77,y:22.754},{x:113.436,y:22.733},{x:113.527,y:22.655},{x:113.572,y:22.496},{x:113.533,y:22.403},{x:113.59,y:22.247},{x:113.531,y:22.175},{x:113.37,y:22.172},{x:113.296,y:22.045},{x:113.009,y:22.125},{x:112.983,y:21.883},{x:112.837,y:21.964},{x:112.742,y:21.924},{x:112.592,y:21.754},{x:112.423,y:21.833},{x:112.382,y:21.723},{x:112.24,y:21.702},{x:112.198,y:21.792},{x:111.786,y:21.707},{x:111.667,y:21.525},{x:111.324,y:21.448},{x:111.25,y:21.487},{x:110.887,y:21.381},{x:110.762,y:21.387},{x:110.626,y:21.216},{x:110.429,y:21.242},{x:110.354,y:21.109},{x:110.181,y:21.022},{x:110.169,y:20.844},{x:110.363,y:20.817},{x:110.329,y:20.692},{x:110.531,y:20.466},{x:110.438,y:20.321},{x:110.302,y:20.25},{x:109.934,y:20.277},{x:110.015,y:20.44},{x:109.835,y:20.49},{x:109.766,y:20.76},{x:109.669,y:20.863},{x:109.775,y:21.231},{x:109.797,y:21.463},{x:109.741,y:21.621},{x:109.899,y:21.658},{x:109.935,y:21.827},{x:110.167,y:21.896},{x:110.351,y:21.988},{x:110.349,y:22.097},{x:110.494,y:22.148},{x:110.763,y:22.322},{x:110.708,y:22.445},{x:110.765,y:22.584},{x:111.051,y:22.654},{x:111.222,y:22.756},{x:111.352,y:22.893},{x:111.425,y:23.038},{x:111.351,y:23.288},{x:111.396,y:23.471},{x:111.483,y:23.632},{x:111.611,y:23.645},{x:111.636,y:23.812},{x:111.925,y:23.974},{x:111.872,y:24.229},{x:112.057,y:24.365},{x:111.941,y:24.587},{x:112.016,y:24.74}]},L.Util.getJsPath=function(){var a,b,c,d;if(!L.Util.path)for(a=document.getElementsByTagName("script"),b=a.length,c=0;b>c;c++)if(-1!=a[c].src.lastIndexOf("zmap.meteo.")){L.Util.path=a[c].src,d=L.Util.path.lastIndexOf("/"),L.Util.path=L.Util.path.substring(0,d+1);break}return L.Util.path},L.Util.pointInPolygon=function(a,b,c){var d,e,f;if(null==c||c.length<3)return!1;for(d=!1,e=c.length,f=0;e>f;f++)sx=c[f].x,sy=c[f].y,ex=c[(f+1)%e].x,ey=c[(f+1)%e].y,(b>=ey&&sy>b||b>=sy&&ey>b)&&(sx-ex)*(b-ey)/(sy-ey)+ex>a&&(d=!d);return d},L.Util.distance=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},L.Util.angle2Rad=function(a){return a*Math.PI/180},L.Util.rad2Angle=function(a){return 180*a/Math.PI},L.Util.lineAngle=function(a,b){var c=b.lat-a.lat,d=b.lng-a.lng,e=L.Util.rad2Angle(Math.atan(c/d));return e>0?b.lng>a.lng?e=e:e+=180:e=0>e?b.lng>a.lng?360+e:180+e:b.lng>a.lng?0:180,90-e},L.Util.linePoint=function(a,b,c){var d=b.lat-a.lat,e=b.lng-a.lng,f=a.lat+d*c,g=a.lng+e*c;return L.latLng(f,g)},L.Util.lineFromPoint=function(a,b){var c={};return c.a=b.y-a.y,c.b=a.x-b.x,c.c=b.x*a.y-a.x*b.y,c},L.Util.verticalLine=function(a,b,c){var e,d={};return a.y==b.y?(d.a=-1,d.b=0,d.c=c.x):a.x==b.x?(d.a=0,d.b=-1,d.c=c.y):(e=(a.x-b.x)/(b.y-a.y),d.a=e,d.b=-1,d.c=c.y-e*c.x),d},L.Util.collinearPoint=function(a,b,c){var d=L.Util.lineFromPoint(a,b),e={x:b.x-a.x,y:b.y-a.y},f=Math.sqrt(e.x*e.x+e.y*e.y),g={x:(d.b*e.x*a.x+d.b*e.y*a.y+d.b*f*c+d.c*e.y)/(e.x*d.b-e.y*d.a),y:-(e.x*d.c+e.x*a.x*d.a+e.y*a.y*d.a+f*c*d.a)/(e.x*d.b-e.y*d.a)};return L.point(g.x,g.y)},L.Util.verticalPoints=function(a,b,c,d){var f,g,h,i;return L.Util.lineFromPoint(a,b),f={x:b.x-a.x,y:b.y-a.y},g=Math.sqrt(f.x*f.x+f.y*f.y),h=[],i=L.Util.verticalLine(a,b,c),h[0]=L.point(-(i.b*f.x*c.y-i.b*f.y*c.x+i.b*g*d+i.c*f.x)/(f.x*i.a+f.y*i.b),(f.x*c.y*i.a-f.y*i.c-f.y*c.x*i.a+g*d*i.a)/(f.x*i.a+f.y*i.b)),h[1]=L.point(-(i.b*f.x*c.y-i.b*f.y*c.x+-1*i.b*g*d+i.c*f.x)/(f.x*i.a+f.y*i.b),(f.x*c.y*i.a-f.y*i.c-f.y*c.x*i.a+-1*g*d*i.a)/(f.x*i.a+f.y*i.b)),h},L.Util.roundPoint=function(a){return a.x=Math.round(a.x),a.y=Math.round(a.y),a},L.Util.getWindLevel=function(a){var c,b=[.3,1.6,3.4,5.5,8,10.8,13.9,17.2,20.8,24.5,28.5,32.7,37,41.5,46.2,51,56.1,61.3,66.8,72.4];for(c=0;c<b.length;c++)if(a<b[c])return c+"级风";return"20级风"},L.Util.getWindDir=function(a){var d,b=[22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5],c=["北风","东北风","东风","东南风","南风","西南风","西风","西北风"];for(d=0;d<b.length-1;d++)if(a>b[d]&&a<=b[d+1])return c[d+1];return c[0]},L.Util.getU=function(a,b){return a*Math.cos(L.Util.angle2Rad(270-b))},L.Util.getV=function(a,b){return a*Math.sin(L.Util.angle2Rad(270-b))},L.Util.ideInterp=function(a,b){var c,d,e,g,h,f,i,k,l,j;if(0==a.length||a.length!=b.length)return 0;for(c=.1,d=b.length,e=new Array(d),f=0,i=0;d>i;i++)h=a[i],g=1/(c+h*h),f+=g,e[i]=g;for(j=0,i=0;d>i;i++)l=b[i],k=e[i]/f*l,j+=k;return j},L.Util.findNearPoint=function(a,b,c,d,e,f){var g,h,i,j,k,l;switch(c){case 0:c+=1;break;case b.ydim-2:c-=1;break;case b.ydim-1:c-=2}switch(d){case 0:d+=1;break;case b.xdim-2:d-=1;break;case b.xdim-1:d-=2}for(g=[],h=c-1;c+1>=h;h++)for(i=d-1;d+1>=i;i++)for(j=a[h][i],k=j.length,l=0;k>l;l++)g.push(j[l]);return g.sort(function(a,b){var c=Math.abs(a.x-e)+Math.abs(a.y-f),d=Math.abs(b.x-e)+Math.abs(b.y-f);return c-d}),g},L.Util.interpDiscreteToGrid=function(a){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,b=a.length,c=999,d=-999,e=-999,f=999;for(g=b-1;g>=0;g--)h=a[g],h.x&&h.y&&"undefined"!=typeof h.val&&null!=h.val?(c>h.x&&(c=h.x),d<h.x&&(d=h.x),e<h.y&&(e=h.y),f>h.y&&(f=h.y)):(console.info("bad point:",h),a.splice(g,1));for(i=(d-c)/(e-f),j=Math.sqrt(b/i),k=Math.ceil(j)+1,l=(e-f)/(k-1),m=(d-c)/l+1,n=Math.ceil(m),o=n-m,p=l*o/2,c-=p,d+=p,k+=1,e+=l/2,f-=l/2,q={left:c,right:d,top:e,bottom:f,xdim:n,ydim:k,xgap:l,ygap:l},r=new Array(q.ydim-1),s=0;s<q.ydim-1;s++)for(r[s]=new Array(q.xdim-1),t=0;t<q.xdim-1;t++)r[s][t]=new Array;for(b=a.length,g=0;b>g;g++)h=a[g],s=Math.floor((q.top-h.y)/q.ygap),t=Math.floor((h.x-q.left)/q.xgap),r[s][t].push(h);for(u=new Array(q.ydim),s=0;s<q.ydim;s++)for(u[s]=new Array(q.xdim),v=q.top-q.ygap*s,t=0;t<q.xdim;t++){for(w=L.Util.findNearPoint(r,q,s,t,A,v),x=w.length>4?4:w.length,y=new Array(x),z=new Array(x),A=q.left+q.xgap*t,g=0;x>g;g++)B=w[g],y[g]=L.Util.distance(A,v,B.x,B.y),z[g]=B.val;u[s][t]=L.Util.ideInterp(y,z)}return{infos:q,dats:u}},L.AngleMarker=L.Marker.extend({_setPos:function(a){L.DomUtil.setPosition(this._icon,a),this._shadow&&L.DomUtil.setPosition(this._shadow,a),this.options.iconAngle&&(this._icon.style.WebkitTransform=this._icon.style.WebkitTransform+" rotate("+this.options.iconAngle+"deg)",this._icon.style.MozTransform=this._icon.style.MozTransform+"rotate("+this.options.iconAngle+"deg)",this._icon.style.MsTransform=this._icon.style.MsTransform+"rotate("+this.options.iconAngle+"deg)",this._icon.style.OTransform=this._icon.style.OTransform+"rotate("+this.options.iconAngle+"deg)",this._icon.style.Transform=this._icon.style.Transform+"rotate("+this.options.iconAngle+"deg)",this._icon.style.transform=this._icon.style.transform+"rotate("+this.options.iconAngle+"deg)"),this.options.iconOrigin&&(this._icon.style.WebkitTransformOrigin=this.options.iconOrigin,this._icon.style.MozTransformOrigin=this.options.iconOrigin,this._icon.style.MsTransformOrigin=this.options.iconOrigin,this._icon.style.OTransformOrigin=this.options.iconOrigin,this._icon.style.TransformOrigin=this.options.iconOrigin,this._icon.style.transformOrigin=this.options.iconOrigin),this._icon.style.zIndex=a.y,this._zIndex=a.y+this.options.zIndexOffset,this._resetZIndex()}}),L.angleMarker=function(a,b){return new L.AngleMarker(a,b)},L.TileLayer2=L.TileLayer.extend({getTileUrl:function(a){var b={z:a.z,x:a.x,y:a.y-Math.pow(2,a.z-2)};return L.Util.template(this._url,L.extend(b,this.options,{s:this._getSubdomain(a)}))}}),L.tileLayer2=function(a,b){return new L.TileLayer2(a,b)},L.ShadeLayer=L.GridLayer.extend({initialize:function(a,b,c,d,e){var f,g,h;b.xdim&&b.ydim&&b.xgap&&b.ygap?(this._dats=a,this._infos=b,this._colortable=c,d&&(d.constructor==Array?(this._cutbounds=d,e?L.setOptions(this,e):L.setOptions(this,{keepBuffer:3,debug:!0})):L.setOptions(this,d))):(f=L.Util.interpDiscreteToGrid(a),this._dats=f.dats,this._infos=f.infos,this._colortable=b,g=c,h=c,g&&(g.constructor==Array?(this._cutbounds=g,h?L.setOptions(this,h):L.setOptions(this,{keepBuffer:3,debug:!0})):L.setOptions(this,g))),this._rebuildColor(this._colortable),console.info("ini")},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(a){var b,c;a._addZoomLimit(this),b=this,c=new Worker(L.Util.getJsPath()+"workerShader.min.js"),c.onmessage=function(a){var e,f,g,h,i,d=c.data[a.data.id];if(!d)return console.error(a.data.id," ctx is null"),void 0;if(e=a.data.size,f=4*e.x*e.y,g=d.getImageData(0,0,e.x,e.y),h=a.data.dats){for(i=0;f>i;i++)g.data[i]=h[i];d.putImageData(g,0,0),b.options.debug&&(d.rect(0,0,256,256),d.stroke())}delete c.data[a.data.id]},c.data={},this._worker=c},onRemove:function(a){this._removeAllTiles(),L.DomUtil.remove(this._container),a._removeZoomLimit(this),this._container=null,this._tileZoom=null,this._worker.terminate(),this._worker=null},_rebuildColor:function(a){var b,c,d,e,f;if(a.colors){for(b=a.colors,c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=this._parseColor(b[e]);a._colors=d}else{for(c=a.length,d=new Array(c),f=new Array(c),e=0;c>e;e++)d[e]=this._parseColor(a[e].color),f[e]=a[e].value;a._colors=d,a._values=f}},_parseColor:function(a){var d,e,b=new Array(4),c=a.length;return"rgba("==a.substr(0,5)?(d=a.substr(5,c-6),e=d.split(","),b[0]=parseInt(e[0],10),b[1]=parseInt(e[1],10),b[2]=parseInt(e[2],10),b[3]=Math.round(255*parseFloat(e[3],10))):"rgb("==a.substr(0,4)?(d=a.substr(4,c-5),e=d.split(","),b[0]=parseInt(e[0],10),b[1]=parseInt(e[1],10),b[2]=parseInt(e[2],10),b[3]=192):"#"==a.substr(0,1)&&(b[0]=parseInt(a.substr(1,2),16),b[1]=parseInt(a.substr(3,2),16),b[2]=parseInt(a.substr(5,2),16),b[3]=192),b},interp:function(a,b){return a<this._infos.left||a>this._infos.right?null:b<this._infos.bottom||b>this._infos.top?null:WeatherScence.interpModel(this._dats,this._infos,a,b)},createTile:function(a){var d,e,f,h,i,b=L.DomUtil.create("canvas","leaflet-tile"),c=this.getTileSize();return b.width=c.x,b.height=c.y,d=b.getContext("2d"),e=a.scaleBy(c),f="EPSG3857",this._map.options.crs==L.CRS.EPSG3395?f="EPSG3395":this._map.options.crs==L.CRS.EPSG3857?f="EPSG3857":this._map.options.crs==L.CRS.EPSG4326?f="EPSG4326":this._map.options.crs==L.CRS.EPSG900913&&(f="EPSG900913"),4*c.x*c.y,h=a.x+"_"+a.y+"_"+a.z,i={id:h,nwPoint:e,coords:a,size:c,projName:f,dats:this._dats,infos:this._infos,colortable:this._colortable,bounds:this._cutbounds},this._worker.data[h]=d,this._worker.postMessage(i),b}}),L.shadeLayer=function(a,b,c,d,e){return new L.ShadeLayer(a,b,c,d,e)},L.FixedLayer=L.Layer.extend({includes:L.Mixin.Events,options:{repeat:"no-repeat",position:"50% 50%",size:"inherit"},initialize:function(a,b){this._url=a,L.setOptions(this,b),this._div||this._createDiv()},onAdd:function(a){this._map=a,this._bounds=this._map.getBounds(),this._div||this._createDiv(),a.getContainer().appendChild(this._div),this._map.on("movestart",this._onMoveStart,this),this._map.on("moveend",this._onMoveEnd,this),this._map.on("resize",this._onResize,this)},onRemove:function(a){this._div&&(this._map.off("movestart",this._onMoveStart,this),this._map.off("moveend",this._onMoveEnd,this),this._map.off("resize",this._onResize,this),a.getContainer().removeChild(this._div))},addTo:function(a){return a.addLayer(this),this},_onMoveStart:function(a){console.info("movestart"),console.info(a)},_onMoveEnd:function(a){console.info("moveend"),console.info(a)},_onResize:function(a){console.info("resize"),console.info(a)},setUrl:function(a){this._url=a,this._div.style.background="url("+this._url+") "+this.options.repeat+" "+this.options.position},setPosition:function(a){this.options.position=a,this._div.style.background="url("+this._url+") "+this.options.repeat+" "+this.options.position},setRepeat:function(a){this.options.repeat=a,this._div.style.background="url("+this._url+") "+this.options.repeat+" "+this.options.position},setSize:function(a){this.options.size=a,this._div.style.backgroundSize=this.options.size},getOptions:function(){return this.options},_createDiv:function(){this._div=L.DomUtil.create("div",""),this._div.style.background="url("+this._url+") "+this.options.repeat+" "+this.options.position,this._div.style.backgroundSize=this.options.size,this._div.style.height="100%",this._div.style.width="100%",this._div.style.pointerEvents="none",this._div.style.position="absolute",this._div.style.zIndex=400}}),L.fixedLayer=function(a,b){return new L.FixedLayer(a,b)},L.WindLayer=L.Layer.extend({includes:L.Mixin.Events,options:{type:"line"},initialize:function(a,b,c,d){if(a.constructor==Array&&b.constructor==Array)this._us=a,this._vs=b,this._infos=c,this._type=d,this._ani=!1;else if(b.constructor==String){var e=a;this._type=b,this._ani=!1,this._buildUV(e)}},_buildUV:function(a){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,b=a.length,c=999,d=-999,e=-999,f=999;for(g=b-1;g>=0;g--)h=a[g],!h.x||!h.y||null==h.dir||h.dir<0||null==h.vel||h.vel<0?(console.info("bad point:",h),a.splice(g,1)):(h.u=L.Util.getU(h.vel,h.dir),h.v=L.Util.getV(h.vel,h.dir),c>h.x&&(c=h.x),d<h.x&&(d=h.x),e<h.y&&(e=h.y),f>h.y&&(f=h.y));for(i=(d-c)/(e-f),j=Math.sqrt(b/i),k=Math.ceil(j)+1,l=(e-f)/(k-1),m=(d-c)/l+1,n=Math.ceil(m),o=n-m,p=l*o/2,c-=p,d+=p,k+=1,e+=l/2,f-=l/2,q={left:c,right:d,top:e,bottom:f,xdim:n,ydim:k,xgap:l,ygap:l},r=new Array(q.ydim-1),s=0;s<q.ydim-1;s++)for(r[s]=new Array(q.xdim-1),t=0;t<q.xdim-1;t++)r[s][t]=new Array;for(b=a.length,g=0;b>g;g++)h=a[g],s=Math.floor((q.top-h.y)/q.ygap),t=Math.floor((h.x-q.left)/q.xgap),r[s][t].push(h);for(u=new Array(q.ydim),v=new Array(q.ydim),s=0;s<q.ydim;s++)for(u[s]=new Array(q.xdim),v[s]=new Array(q.xdim),w=q.top-q.ygap*s,t=0;t<q.xdim;t++){for(x=L.Util.findNearPoint(r,q,s,t,C,w),y=x.length>4?4:x.length,z=new Array(y),A=new Array(y),B=new Array(y),C=q.left+q.xgap*t,g=0;y>g;g++)D=x[g],z[g]=L.Util.distance(C,w,D.x,D.y),A[g]=D.u,B[g]=D.v;u[s][t]=L.Util.ideInterp(z,A),v[s][t]=L.Util.ideInterp(z,B)}this._us=u,this._vs=v,this._infos=q},lowCenterCallback:function(a){this._lowCenterCallback=a},interp:function(a,b){var c,d,e,f,g,h;return this._us&&this._vs?a<this._infos.left||a>this._infos.right?null:b<this._infos.bottom||b>this._infos.top?null:(c=WeatherScence.interpModel(this._us,this._infos,a,b),d=WeatherScence.interpModel(this._vs,this._infos,a,b),e=WeatherScence.getDir(c,d),f=WeatherScence.getVel(c,d),g=L.Util.getWindDir(e),h=L.Util.getWindLevel(f),{u:c,v:d,dir:e,vel:f,dirDes:g,velDes:h}):null},onAdd:function(a){this._map=a,this._bounds=this._map.getBounds(),this._div||this._createDiv(),this._ani||(this._weatherAnim(),this._ani=!0),this._eleContainer=a.getContainer().getElementsByClassName("leaflet-map-pane")[0];var b=this._eleContainer.getElementsByClassName("leaflet-tile-pane")[0];this._eleContainer.insertBefore(this._div,b.nextSibling),this._onResize(),this._onMoveEnd(),a.on("movestart",this._onMoveStart,this),a.on("moveend",this._onMoveEnd,this),a.on("resize",this._onResize,this)},onRemove:function(a){if(this._div){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;b||(b=function(a){clearTimeout(a)}),b(this._aniFrame),this._ani=!1,a.off("movestart",this._onMoveStart,this),a.off("moveend",this._onMoveEnd,this),a.off("resize",this._onResize,this),this._eleContainer.removeChild(this._div)}},addTo:function(a){return a.addLayer(this),this},changeWindStyle:function(a){this._type=a},show:function(a){this._ws.show=a},_onResize:function(){var b,c;this._div&&(b=this._map.getSize().x,c=this._map.getSize().y,this._weatherCanvas.width=b,this._weatherCanvas.height=c,this._bufferCanvas1.width=b,this._bufferCanvas1.height=c,this._bufferCanvas2.width=b,this._bufferCanvas2.height=c,this._ws.show=!1)},_onMoveStart:function(){this._ws.show=!1},_onMoveEnd:function(){var b=this._eleContainer.style[L.DomUtil.TRANSFORM],c=b.indexOf("("),d=b.indexOf(")"),e=b.substring(c+1,d).split(","),f=2==e.length?b.substr(0,c)+"("+-parseInt(e[0])+"px,"+-parseInt(e[1])+"px)":b.substr(0,c)+"("+-parseInt(e[0])+"px,"+-parseInt(e[1])+"px,"+-parseInt(e[2])+"px)";this._div.style.transform=f,this._ws.changeSize(),this._ws.show=!0},_createDiv:function(){var a,b,c,d,e,f,g;this._div=L.DomUtil.create("div",""),this._div.style.height="100%",this._div.style.width="100%",this._div.style.pointerEvents="none",this._div.style.position="absolute",this._div.style.zIndex=200,a=document.createElement("canvas"),b=a.getContext("2d"),this._weatherCanvas=a,a.style.imageRendering="pixelated",a.style.position="absolute",a.style.left="0px",a.style.top="0px",this._div.appendChild(a),a.style.pointerEvents="none",a.width=this._map.getSize().x,a.height=this._map.getSize().y,a.oncontextmenu=function(){return!1},a.onselectstart=function(){return!1},c=document.createElement("canvas"),d=c.getContext("2d"),this._bufferCanvas1=c,c.style.imageRendering="pixelated",c.width=this._map.getSize().x,c.height=this._map.getSize().y,e=document.createElement("canvas"),f=e.getContext("2d"),this._bufferCanvas2=e,e.style.imageRendering="pixelated",e.width=this._map.getSize().x,e.height=this._map.getSize().y,this._lowCenters=[],this._ws=new WeatherScence(a,b,c,d,e,f,this,this._map),this._ws.initData(this._us,this._vs,this._infos),g=this,this._weatherAnim=function(){var a,b,c,d,e,f,h,i,j,k,l;if(g._ws.ctx.clearRect(0,0,g._ws.width,g._ws.height),g._ws.rctx.clearRect(0,0,g._ws.width,g._ws.height),g._ws.show){for(a=g._ws.particles[0],b=0;b<a.tiles.length;b++)for(c=0;c<a.tiles[0].length;c++)g._ws.tiles[b][c]=0;for(d=g._ws.particles.length,e=d-1;e>=0;e--)g._ws.particles[e].age>6800||g._ws.particles[e].still?g._ws.particles.splice(e,1):g._ws.particles[e].draw();switch(a=g._ws.particles[0],f=a.bounds,h=5,g._map.getZoom()){case 1:h=4;break;case 2:h=6;break;case 3:h=8;break;case 4:h=10;break;case 5:h=12;break;case 6:h=10;break;case 7:h=9;break;case 8:h=8;break;case 9:h=7;break;case 10:h=6}for(b=0;b<a.tiles.length;b++)for(c=0;c<a.tiles[0].length;c++)for(i=null,j=h-g._ws.tiles[b][c],j>0&&(i={left:f.left+c*f.tileXGap,right:f.left+(c+1)*f.tileXGap,top:f.top-b*f.tileYGap,bottom:f.top-(b+1)*f.tileYGap}),e=0;j>e;e++)k=new WeatherScence.WindDrop(a.ctx,a.width,a.height,a.map,a.layer,a.windColors,a.us,a.vs,a.infos,a.bounds,i,a.tiles,a.lw,a.ll),g._ws.particles.push(k);g._ws.rctx.drawImage(g._ws.bcvs,0,0),g._ws.rctx.drawImage(g._ws.cvs,0,0),g._ws.bctx.globalAlpha=.96,g._ws.bctx.clearRect(0,0,g._ws.width,g._ws.height),g._ws.bctx.drawImage(g._ws.rcvs,0,0)}l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,l||(l=function(a){window.setTimeout(a,1e3/60)}),g._aniFrame=l(g._weatherAnim)}}}),L.windLayer=function(a,b,c,d){return new L.WindLayer(a,b,c,d)},WeatherScence.MISS=-9999,WeatherScence.random=function(a,b){return Math.random()*(b-a)+a},WeatherScence.rad2Angle=function(a){return 180*a/Math.PI},WeatherScence.angle2Rad=function(a){return a*Math.PI/180},WeatherScence.getDrawRad=function(a,b){return 1.5*Math.PI+Math.atan2(a,b)},WeatherScence.getDir=function(a,b){return 180+180*Math.atan2(a,b)/Math.PI},WeatherScence.getVel=function(a,b){return Math.sqrt(a*a+b*b)},WeatherScence.interpLinearColor=function(a,b,c,d){var e,f;return b>d?null:(e=a.length,f=Math.floor((d-b)/c),f>e-1?a[e-1]:a[f])},WeatherScence.interpModel=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;return c<b.left||c>b.right||d<b.bottom||d>b.top||isNaN(c)||isNaN(d)?WeatherScence.MISS:(e=Math.floor((c-b.left)/b.xgap),f=Math.floor((b.top-d)/b.ygap),0>f||f>=b.ydim-1||0>e||e>=b.xdim-1?WeatherScence.MISS:(g=a[f][e],h=a[f][e+1],i=a[f+1][e],j=a[f+1][e+1],k=b.left+e*b.xgap,l=k+b.xgap,m=b.top-f*b.ygap,n=m-b.ygap,o=WeatherScence.interpLine(m,g,n,i,d),p=WeatherScence.interpLine(m,h,n,j,d),q=WeatherScence.interpLine(k,o,l,p,c)))},WeatherScence.interpLine=function(a,b,c,d,e){return b+(e-a)/(c-a)*(d-b)},WeatherScence.prototype={_change:function(a,b,c,d,e,f,g){var j,k,l,m,n,o;for(this.width=a,this.height=b,this.rcvs.width=a,this.rcvs.height=b,this.bcvs.width=a,this.bcvs.height=b,this.layer=c,this.map=d,this.us=e,this.vs=f,this.infos=g,this.particles=new Array,j=this.map.getBounds(),j.left=Math.max(this.infos.left,j.getWest()),j.right=Math.min(this.infos.right,j.getEast()),j.top=Math.min(this.infos.top,j.getNorth()),j.bottom=Math.max(this.infos.bottom,j.getSouth()),this.tiles=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],j.tileXGap=(j.right-j.left)/this.tiles[0].length,j.tileYGap=(j.top-j.bottom)/this.tiles.length,console.info(j),k=1,l=d.getSize().x/300*d.getZoom()/7,l=1.3>=l?1.3:l,console.info(this.ll),m=300,n=0;m>n;n++)o=new WeatherScence.WindDrop(this.ctx,this.width,this.height,this.map,this.layer,this.windColors,this.us,this.vs,this.infos,j,j,this.tiles,k,l),this.particles[n]=o},evoluteData:function(a,b){var c,d;for(this.us=a,this.vs=b,c=this.particles.length,d=0;c>d;d++)this.particles[d].us=a,this.particles[d].vs=b},initData:function(a,b,c){this.us=a,this.vs=b,this.infos=c,this._change(this.map.getSize().x,this.map.getSize().y,this.layer,this.map,this.us,this.vs,this.infos)},changeSize:function(){this._change(this.map.getSize().x,this.map.getSize().y,this.layer,this.map,this.us,this.vs,this.infos)}},WeatherScence.WindDrop=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){this.ctx=a,this.width=b,this.height=c,this.map=d,this.windColors=f,this.us=g,this.vs=h,this.infos=i,this.bounds=j,this.genArea=k,this.tiles=l,this.size=2,this.lw=m,this.ll=n,this.speed=.1*(j.right-j.left)/1e3,this.stillLine=5*this.speed+.08,this.layer=e,this.init()},WeatherScence.WindDrop.prototype={init:function(){this.layer._lowCenterCallback&&(this._poses=[],this._dirs=[],this._direction=0,this._directDelt=0),this.lon=WeatherScence.random(this.genArea.left,this.genArea.right),this.lat=WeatherScence.random(this.genArea.bottom,this.genArea.top),this._updatePos(),this.color=this.windColors[Math.floor(this.vel/.5)],this.age=0
},draw:function(){var a,b,c,d,e;this.u>-99&&this.v>-99&&("circle"==this.layer._type?(this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.size,0,2*Math.PI),this.ctx.fill()):"line"==this.layer._type?(this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.lw,a=this.x-this.ll*Math.cos(this.dir),b=this.y-this.ll*Math.sin(this.dir),this.ctx.beginPath(),this.ctx.moveTo(this.x,this.y),this.ctx.lineTo(a,b),this.ctx.stroke()):"arrow"==this.layer._type?(this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.lw,c=.15,d=this.x-this.ll*Math.cos(this.dir-c),e=this.y-this.ll*Math.sin(this.dir-c),a=this.x-this.ll*Math.cos(this.dir+c),b=this.y-this.ll*Math.sin(this.dir+c),this.ctx.beginPath(),this.ctx.moveTo(this.x,this.y),this.ctx.lineTo(d,e),this.ctx.moveTo(this.x,this.y),this.ctx.lineTo(a,b),this.ctx.stroke()):"wave"==this.layer._type&&(this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.lw,c=Math.PI/4,d=this.x-this.size*Math.cos(this.dir-c),e=this.y-this.size*Math.sin(this.dir-c),a=this.x-this.size*Math.cos(this.dir+c),b=this.y-this.size*Math.sin(this.dir+c),this.ctx.beginPath(),this.ctx.moveTo(d,e),this.ctx.lineTo(a,b),this.ctx.stroke())),this.update()},update:function(){this.still=Math.abs(this.u)+Math.abs(this.v)<this.stillLine,this.u>-99&&this.v>-99&&(this.lon+=this.speed*this.u,this.lat+=this.speed*this.v),this.age++,this.lon<this.bounds.left||this.lon>this.bounds.right||this.lat<this.bounds.bottom||this.lat>this.bounds.top?this.init():(this._x&&this._y&&this._x==this.x&&this._y==this.y?this.age=9999:this._updatePos(),0==this.age%500&&(this._x=this.x,this._y=this.y))},_updatePos:function(){var a,b,c;return isNaN(this.lon)||isNaN(this.lat)?(console.info("error:"+this.lon+","+this.lat),this.lon=WeatherScence.random(this.genArea.left,this.genArea.right),this.lat=WeatherScence.random(this.genArea.bottom,this.genArea.top),void 0):(a=Math.floor((this.lon-this.bounds.left)/this.bounds.tileXGap),b=Math.floor((this.bounds.top-this.lat)/this.bounds.tileYGap),this.tiles[b][a]++,this.u=WeatherScence.interpModel(this.us,this.infos,this.lon,this.lat),this.v=WeatherScence.interpModel(this.vs,this.infos,this.lon,this.lat),this.dir=WeatherScence.getDrawRad(this.u,this.v),this.vel=WeatherScence.getVel(this.u,this.v),this.layer._lowCenterCallback&&(this._inLowCenter()?(this._poses.length=0,this._dirs.length=0,this._direction=0,this._directDelt=0):this._findLowCenter()),c=this.map.latLngToContainerPoint([this.lat,this.lon]),c&&(this.x=c.x,this.y=c.y),void 0)},_inLowCenter:function(){var b,c,a=this.layer._lowCenters.length;for(b=0;a>b;b++)if(c=this.layer._lowCenters[b],this.lon>=c.left&&this.lon<=c.right&&this.lat>=c.bottom&&this.lat<=c.top)return!0;return!1},_calcDirectionComponent:function(a,b){return Math.abs(b-a)>180?b>a?{direct:-1,dlt:-a+b-360}:{direct:1,dlt:360-a+b}:b>a?{direct:1,dlt:b-a}:{direct:-1,dlt:b-a}},_getLowCenter:function(a){var g,h,b=180,c=-180,d=-90,e=90,f=a.length;for(g=0;f>g;g++)h=a[g],h.lon<b&&(b=h.lon),h.lon>c&&(c=h.lon),h.lat<e&&(e=h.lat),h.lat>d&&(d=h.lat);return{left:b,right:c,top:d,bottom:e,lon:a[f-1].lon,lat:a[f-1].lat}},_findLowCenter:function(){var b,c,d,a=this._dirs.length;2>a?(b=WeatherScence.getDir(this.u,this.v),this._poses.push({lon:this.lon,lat:this.lat}),this._dirs.push(b)):2==a?(b=WeatherScence.getDir(this.u,this.v),c=this._calcDirectionComponent(this._dirs[0],this._dirs[1]),this._direction=c.direct,this._directDelt=c.dlt,c=this._calcDirectionComponent(this._dirs[1],b),this._direction==c.direct?(this._poses.push({lon:this.lon,lat:this.lat}),this._dirs.push(b),this._directDelt+=c.dlt):(this._poses[0]=this._poses[1],this._poses[1]={lon:this.lon,lat:this.lat},this._dirs[0]=this._dirs[1],this._dirs[1]=b,this._direction=c.direct,this._directDelt=c.dlt)):(b=WeatherScence.getDir(this.u,this.v),c=this._calcDirectionComponent(this._dirs[a-1],b),this._direction==c.direct?(this._poses.push({lon:this.lon,lat:this.lat}),this._dirs.push(b),this._directDelt+=c.dlt,(this._directDelt<-480||this._directDelt>480)&&(d=this._getLowCenter(this._poses),this.layer._lowCenters.push(d),this.layer._lowCenterCallback(d.lon,d.lat))):(this._poses[0]=this._poses[a-1],this._poses[1]={lon:this.lon,lat:this.lat},this._dirs[0]=this._dirs[a-1],this._dirs[1]=b,this._direction=c.direct,this._directDelt=c.dlt,this._poses.length=2,this._dirs.length=2))}},L.BusinessOverlay=L.Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(a,b){a.constructor==Array?this._urls=a:this._url=a,L.setOptions(this,b);var c=this.options;c.fit="undefined"!=typeof c.left&&"undefined"!=typeof c.right&&"undefined"!=typeof c.top&&"undefined"!=typeof c.bottom?!0:!1},onAdd:function(a){this._map=a;var b=this.options;this._bounds=b.fit?L.latLngBounds([[b.top,b.left],[b.bottom,b.right]]):a.getBounds(),this._url&&!this._image?this._initImage():this._urls&&!this._image&&(this._initImage(),this._imgId=0,this._initImageAni()),this.options.opacity<1&&this._updateOpacity(),this.options.interactive&&(L.DomUtil.addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){L.DomUtil.remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image),this.stopAnimate()},addTo:function(a,b){return a.addLayer(this),this._callback=b,this},setOpacity:function(a){return this.options.opacity=a,this._image&&this._updateOpacity(),this},setStyle:function(a){return a.opacity&&this.setOpacity(a.opacity),this},bringToFront:function(){return this._map&&L.DomUtil.toFront(this._image),this},bringToBack:function(){return this._map&&L.DomUtil.toBack(this._image),this},setUrl:function(a){return this._url=a,this._image&&(this._loaded=!1,this._image.src=a),this},setBounds:function(a){return this._bounds=L.latLngBounds(a),this._map&&this._reset(),this},setUrlAutoFit:function(a,b){this._url=a,this._callback=b,this._bounds=this._map.getBounds(),this.setBounds(this._bounds),this.setUrl(a)},getEvents:function(){var a={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(a.zoomanim=this._animateZoom),a},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){this._loaded=!1;var a=this._image=L.DomUtil.create("img","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":"")+(this.options.className||""));a.onselectstart=L.Util.falseFn,a.onmousemove=L.Util.falseFn,a.onload=L.bind(this._onImageLoad,this,"load"),a.onerror=L.bind(this._overlayOnError,this,"error"),this.options.crossOrigin&&(a.crossOrigin=""),this.options.zIndex&&this._updateZIndex(),a.src=this._url?this._url:this._urls[0],a.alt=this.options.alt},_initImageAni:function(){var a=this;a._ani&&clearInterval(a._ani),a._ani=setInterval(function(){a._loaded&&(a._callback&&a._callback(a._imgId,a._urls[a._imgId]),a._imgId=a._imgId+1,a._imgId>=a._urls.length&&!a.options.loop&&a.stopAnimate(),a._imgId=a._imgId%a._urls.length,a.options.fit?a.setUrl(a._urls[a._imgId],a._callback):a.setUrlAutoFit(a._urls[a._imgId],a._callback))},a.options.time)},startAnimate:function(){this._urls.constructor==Array&&this._initImageAni()},stopAnimate:function(){this._ani&&clearInterval(this._ani)},_animateZoom:function(a){var b=this._map.getZoomScale(a.zoom),c=this._map._latLngBoundsToNewLayerBounds(this._bounds,a.zoom,a.center).min;L.DomUtil.setTransform(this._image,c,b)},_reset:function(){var a=this._image,b=new L.Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),c=b.getSize();L.DomUtil.setPosition(a,b.min),a.style.width=c.x+"px",a.style.height=c.y+"px"},_updateOpacity:function(){setOpacity(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_onImageLoad:function(){this.fire("load"),!this._urls&&this._callback&&(this._callback(this._url),this._callback=null),this._loaded=!0},_overlayOnError:function(){this.fire("error");var a=this.options.errorOverlayUrl;a&&this._url!==a&&(this._url=a,this._image.src=a)}}),L.businessOverlay=function(a,b){return new L.BusinessOverlay(a,b)};